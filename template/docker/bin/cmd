#!/bin/bash

# Override env vars. Only change this is you know what you are doing.
# DATABASE_URL="mysql2://deploy:deploy@mysql:3306/hw_admin"
# RAILS_ENV=development
# THIN_SERVERS_COUNT=14
APP_NAME=__APP_NAME__
APP_ROOT=/$APP_NAME


cd $APP_ROOT

echo "STARTING $APP_NAME ON ENVIRONMENT: $CTHULHU_ENV"

if [ ! -d "$APP_ROOT/tmp/pids" ]; then
  mkdir -pv $APP_ROOT/tmp/pids
fi
rm $APP_ROOT/tmp/pids/*

function production {
  bundle check || bundle install --without development test
  cthulhu s
}

function development {
  bundle check || bundle install --with development test
  while true; do bash; echo 'To detach the tty, use the escape sequence Ctrl+p + Ctrl+q';done
}

function staging {
  production
}

function test {
  bundle exec rspec
}

# calls the right function
`echo $CTHULHU_ENV`
